#	WELCOME TO SQUID 3.xx build by rapani-id.com
#  Jika Menemukan kekurangan mohon Masukannnya, send mail to kontak@rapani-id.com
#
#	----------------------------
acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 81		# http alt
acl Safe_ports port 8080	# http alt
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT


#-------------------------------------------------
#flvto.com
acl ip_store-id dst 178.162.210.70
#nfs_ea
acl janganTabrak dst 94.236.124.241 94.236.46.101
#gcc garena
acl janganTabrak dst 203.117.172.5 203.117.155.98
#rohan
acl janganTabrak dst 202.93.21.243 202.93.21.242

#---------------------------------------------------------------------------------------------

#Deny Access 
acl deny_domain dstdomain .windowsupdate.com .dl.ws.microsoft.com 
acl deny_domain dstdomain .googlesyndication.com .doubleclick.net .beritavideo.info
http_access deny deny_domain

#------------------------------------------------------------------------------------------------
#acl aclname dstdomain [-n] .foo.com
#----------------------------------------
acl rapani-id dstdomain .akamaihd.net
acl rapani-id dstdomain .xx.fbcdn.net
acl rapani-id dstdomain .ytimg.com
acl rapani-id dstdomain .instagram.com
acl rapani-id dstdomain .virtualearth.net
acl rapani-id dstdomain .blogspot.com
acl rapani-id dstdomain .photobucket.com
acl rapani-id dstdomain .dl.sourceforge.net	
acl rapani-id dstdomain .filehippo.com
acl rapani-id dstdomain .4shared.com
acl rapani-id dstdomain .fosshub.com
acl rapani-id dstdomain .softpedia.com
acl rapani-id dstdomain .softpedia.ro
acl rapani-id dstdomain .majorgeeks.com
acl rapani-id dstdomain software-files-a.cnet.com
acl rapani-id dstdomain .turbobit.net
acl rapani-id dstdomain .firedrive.com
acl rapani-id dstdomain .zippyshare.com
acl rapani-id dstdomain .mediafire.com
acl rapani-id dstdomain .sharebeast.com
acl rapani-id dstdomain .fileswap.com
acl rapani-id dstdomain .tusfiles.net
acl rapani-id dstdomain .solidfilesusercontent.com
acl rapani-id dstdomain .aclst.com
acl rapani-id dstdomain .vidtomp3.com
acl rapani-id dstdomain .listentoyoutube.com
acl rapani-id dstdomain .music-clips.net
acl rapani-id dstdomain .last.fm
acl rapani-id dstdomain .hs.llnwd.net
acl rapani-id dstdomain .soundcloud.com
acl rapani-id dstdomain .dl.ws.microsoft.com

#deny_url
#--------------------------------------------------------------------------------------------
acl deny_url url_regex -i ^https?:\/\/cache\.pack\.google\.com\/edgedl\/.*\.(exe|crx|msi)$
acl deny_url url_regex -i ^https?:\/\/.*\.c\.pack\.google\.com\/edgedl\/.*\.(exe|crx|msi)\?
http_access deny deny_url
http_reply_access deny deny_url


#-------------------------------------------------------------
acl deny_cache url_regex -i \.*(youtube|google).*\/s?.*\=.*&vq\=.*&fs\=.*$
acl deny_cache url_regex -i ^https?.*(mdn.net\/instream|googleapis.com|doubleclick.net)\/.*\/adsapi.*\.swf$
acl deny_cache url_regex -i \.*mdn\.net\/instream\/html5/.*
cache deny deny_cache

#------------------------------------------------------------

acl deny_toHelper url_regex -i redbot\.org (get_video|videoplayback\?id|videoplayback.*id).*begin\=[1-9][0-9]*
#-------------------------------------------------------------
acl youtube url_regex -i youtube.*(ptracking|stream_204|playback|player_204|gen_204|watchtime|set_awesome|s\?|ads).*(video_id|docid|\&v|content_v)\=([^\&\s]*).*
acl youtube url_regex -i (youtube|googlevideo).*videoplayback\?
#--------------------------------------------------------------
acl rapani_loebis url_regex -i ^http:\/\/[^\/]*\/depot\/[^\/]*\/chunk\/
acl rapani_loebis url_regex -i ^http.*speedtest.*\/(.*\.(jpg|png|txt))\?
acl rapani_loebis url_regex -i ^https?:\/\/(kh|mt[0-9]).google\.com\/.*\/pb=.*
acl rapani_loebis url_regex -i ^https?:\/\/(kh|khmdb).google\.com\/flatfile\?
acl rapani_loebis url_regex -i reverbnation.*(audio_player|ec_stream_song).*$
acl rapani_loebis url_regex -i \.c\.(reverbnation|c2lo)\.com\/(get_audio|audioplayback|audioplay).*$
acl rapani_loebis url_regex ^https?:\/\/.*\.c\.android\.clients\.google\.com\/
acl rapani_loebis url_regex -i ^https?.*\/__utm.gif\?
acl rapani_loebis url_regex -i ^https?:\/\/attachment\.fbsbx\.com\/file_download\.php\?
acl rapani_loebis url_regex -i ^https?:\/\/.*\.gstatic\.com\/images\?
acl rapani_loebis url_regex -i ^https?:\/\/.*cdn\.mozilla\.net\/pub\/firefox\/
acl rapani_loebis url_regex -i ^httpS?:\/\/.*\.google\.com\/edgedl\/

#---------------------------------------------------------------------
acl GET_ONLY method GET
#----------------------------------------------------------------------

#  TAG: http_access
http_access deny !Safe_ports 
http_access deny CONNECT !SSL_ports 
http_access allow localnet
http_access allow localhost
http_reply_access allow all
icp_access allow all
always_direct allow all
http_access deny all


# NETWORK OPTIONS
# -----------------------------------------------------------------------------
https_port 3127 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem
http_port 3129 tproxy
http_port 3128

#  TAG: ssl_bump
ssl_bump none localhost
ssl_bump none janganTabrak
ssl_bump server-first all
sslcrtd_program /usr/lib/squid/ssl_crtd -s /db/certs/ -M 4MB
sslcrtd_children 10
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER

#---------------------------------

# MEMORY CACHE OPTIONS
# -----------------------------------------------------------------------------
cache_mem 2048 MB
maximum_object_size_in_memory 32 KB
maximum_object_size 629145600 bytes
minimum_object_size 128 bytes
memory_replacement_policy heap GDSF
cache_replacement_policy heap LFUDA

#dir cache --------------------------------------------------------------------
cache_dir aufs /cache 25000 59 256

#-------------------------------------------------------------------------------
cache_swap_low 90
cache_swap_high 95

#  TAG: access_log
#logfile_daemon /usr/lib/squid/log_file_daemon
logfile_rotate 1

strip_query_terms off
coredump_dir /cache

#  TAG: store_id_program
store_id_program /etc/squid/store-id.pl
store_id_children 20 startup=10 idle=5 concurrency=100
store_id_access deny !GET_ONLY
store_id_access deny deny_toHelper
store_id_access allow ip_store-id
store_id_access allow rapani-id
store_id_access allow youtube
store_id_access allow rapani_loebis
store_id_access deny all

#--------------------------------------------------------------------------------------------
max_stale 50 years

#  TAG: refresh_pattern
#---------------------------------------------
refresh_pattern -i ^http:\/\/touchcdn\.prodigy\.co\.id\/root\/.* 10080 80% 43500 override-expire ignore-reload ignore-no-store ignore-private ignore-auth ignore-must-revalidate store-stale
refresh_pattern -i ^http:\/\/static\.cdn\.ea\.com\/.*\.dat$ 10080 99% 259200 override-expire ignore-reload ignore-no-store ignore-private ignore-auth ignore-must-revalidate store-stale
refresh_pattern ^.*safebrowsing.*google 259200 99% 525960 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
refresh_pattern ^http.*books\.google\.(co.id|com)\/books\?id=.*sig=.* 10080 99% 259200 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
refresh_pattern -i ^http:\/\/analytics\.com\/__utm\.gif 10080 99% 262980 override-expire ignore-reload ignore-no-store ignore-private ignore-auth ignore-must-revalidate store-stale
refresh_pattern -i ^https?:\/\/.*\.macromedia\.com\/get\/flashplayer\/update\/.*\.z$ 10080 99% 259200 override-expire override-lastmod reload-into-ims
#===============================================================================================================
#anti virus
refresh_pattern -i ^http.*antivirus\.proxy\.rapani-id 4320 50% 8640 reload-into-ims
refresh_pattern -i \.avira-update.com\update\.*\.gz 4320 50% 8640 reload-into-ims

#sensitif
refresh_pattern ^http:\/\/.*\.(crossfire.web\.id|worldinayodance\.com)\/.*\.(ini|list}inf|xml) 0 0% 0
refresh_pattern ^http:\/\/patch\.gemscool\.com\/dz\/live\/DZPatch\/Patched_GameLoader\.exe 0 0% 0
refresh_pattern -i \.lytogame\.com\/.*\.(ini|inf) 0 0% 0
refresh_pattern -i ^http:\/\/.*\.winnerinter\.co\.id\/new_autopatch\/.*\.xml 0 0% 0
refresh_pattern -i ^http.*\.gemscool.com\/lsaga\/hackshield\/.* 0 0% 0
refresh_pattern -i ^http.*(hackshield|nprotect|webnProtect).* 0 0% 0
refresh_pattern  ^http:\/\/patch\.gemscool\.com\/lsaga\/.* 0 0% 0
refresh_pattern ^http:\/\/lostsaga-image\.gscdn\.com\/.* 0 0% 0
refresh_pattern -i ^http:\/\/.*\.(garenanow|starhub)\.com\/.*\.(dll|php|version|xml|js)$ 0 0% 0
refresh_pattern -i ^http:\/\/.*\.garenanow\.com\/.*\/(app|ui)$ 0 0% 0
refresh_pattern -i ^http:\/\/update3\.netmarble\.co\.id\/sf2\/.*\/.*\.(xml|jpg)\.dfg 0 0% 0

#Store-id ================================================================================================
refresh_pattern ^http.*proxy\.rapani-id  43830 99% 80640 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
#----------------------------------------------------------------------------------------------------------------
#file extensi
refresh_pattern -i \.(gif|png|pnp|img|jpg|jpeg|jpe?g|jpeg2|ico|mod|bmp|eps|tif|tiff?|pcx|pic|tga|iff|sct|pxr|raw|dcs|rle|lzw|ccit|f3d|woff)$ 10080 99% 40320 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
refresh_pattern -i \.(pps|ppsx|ps|rtx|wpl|doc|docx|pdf|xls|xlsx|latex|ppt|pptx|mbd|asm|bat|psd)$ 10080 80% 40320 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
refresh_pattern -i \.(mp4|3ivx|asf|avi|m2ts|divx|mjpeg|ogv|webm|mpg|mpeg|ogg|wmv|mkv|3gp|swf|flv|x-flv|3g2|vob|swf|swz|mov|m4v)$ 10080 99% 40320 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
refresh_pattern -i \.(ogg|mp2|ac3|mpc|m4a|flac|aiff|aif|aifc|raw|au|mid|wav|wv|mp3|gsm|dct|aac|mmf|wma|atrac|ra|ram|dss|msv|dvf|m4p|amr|awb|ape|apl)$ 10080 99% 40320 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
refresh_pattern -i \.(exe|dfg|crx|7z|mds|mod|mdl|arj|bz2|ms-dos|ccd|sub|deb|cab|pak|bin|cue|nrg|isz|mdf|qt|zip|tar|jar|jxr|jad|tar.gz|tar|msi|inc)$ 10080 99% 40320 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale
refresh_pattern -i \.(lha|ms(i|p|u)|rpm|rtp|rpz|nui|kom|stg|pak|sup|nzp|npz|tgz|reg|vpx|avc|ref|msp|iso|rar|mar|pkg|gmf|apk|bfz|auz)$ 10080 99% 40320 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-store ignore-must-revalidate  ignore-private ignore-auth refresh-ims  store-stale

#------------------------------------
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern (index|home|default)\.(htm|php|asp|asp|aspx|shtml|cfm|cfml|phtml) 0 0% 0
refresh_pattern \.(htm|php|asp|asp|aspx|shtml|cfm|cfml|phtml|jsp|cgi|asx|css|js|xml)\? 0 0% 0
refresh_pattern . 0 50% 1440 reload-into-ims

#-------------------------------------

range_offset_limit 1 KB
quick_abort_min 1 KB
quick_abort_max 1 KB
quick_abort_pct 99
negative_ttl 1 seconds
positive_dns_ttl 24 hours
negative_dns_ttl 1 minutes
forward_timeout 2 minutes
minimum_expiry_time 1 seconds
retry_on_error on
via off

#-------------------------------------

#  TAG: request_header_access
forwarded_for off
request_header_access X-Forwarded-For deny all
request_header_access Server deny all
request_header_access From deny all
request_header_access Via deny all
request_header_access Link deny all

##------------------------------------
shutdown_lifetime 15 seconds

# ADMINISTRATIVE PARAMETERS
# -----------------------------------------------------------------------------
cache_mgr webmaster
cache_effective_user proxy
cache_effective_group proxy
visible_hostname rapani
dns_nameservers 127.0.0.1
ipcache_size 2048
ipcache_low 90
ipcache_high 95
fqdncache_size 1024
memory_pools off
client_db off
reload_into_ims on
vary_ignore_expire on
workers 1

# TAG ZPH
qos_flows local-hit=0x20
qos_flows sibling-hit=0x20
qos_flows parent-hit=0x20

