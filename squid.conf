acl all src 
acl SSL_ports port 443 
acl Safe_ports port 80 
acl Safe_ports port 21 
acl Safe_ports port 443 
acl Safe_ports port 70 
acl Safe_ports port 210 
acl Safe_ports port 1025-65535 
acl Safe_ports port 280 
acl Safe_ports port 488 
acl Safe_ports port 591 
acl Safe_ports port 777 
acl CONNECT method CONNECT 
acl getmethod method GET

acl deny_domain dstdomain .windowsupdate.com
http_access deny deny_domain

acl deny_url url_regex -i ^https?:\/\/.*cdn\.mozilla\.(net|org)\/pub\/firefox\/(releases|candidates)\/.*\/update\/win32\/.*
acl deny_url url_regex -i ^https?:\/\/.*\.pack.google.com\/edgedl\/chrome\/win\/.*
acl deny_url url_regex -i ^https?:\/\/cache.pack.google.com\/edgedl\/.*
acl deny_url url_regex -i ^https?:\/\/www.google.com\/dl\/chrome\/win\/.*
http_access deny deny_url

cache_mgr MikrotikSquidIndonesia 
visible_hostname MikrotikSquidIndonesia

cache_mem 8 MB
cache_swap_low 98 
cache_swap_high 99 
ipcache_size 2048 
ipcache_low 98
ipcache_high 99 

################################


maximum_object_size 1024 MB 
maximum_object_size_in_memory 512 KB
cache_replacement_policy heap LFUDA
memory_replacement_policy heap GDSF

cache_dir aufs /cache 12800 30 256
coredump_dir /cache
 
 
access_log stdio:/var/log/squid/access.log
#cache_log /var/log/squid/cache.log
cache_store_log none 
logfile_rotate 1


always_direct allow all 
ssl_bump server-first all 
http_access deny !Safe_ports 
http_access deny CONNECT !SSL_ports 
http_access allow all 
http_reply_access allow all 
icp_access allow all 

##################################################
#tproxy/intercept

https_port 3127 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem
http_port 3129 tproxy
http_port 3128

sslcrtd_program /usr/lib/squid/ssl_crtd -s /etc/squid/ssl_db/certs/ -M 4MB
sslcrtd_children 10
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER

strip_query_terms off
max_stale 1 year


refresh_pattern -i akamaihd.net.* 43830 99% 43830 override-expire override-lastmod ignore-reload
refresh_pattern -i https:\/\/.*\.xx\.fbcdn\.net\/.* 43830 99% 43830 override-expire override-lastmod ignore-reload
refresh_pattern ^.*safebrowsing.*google 43830 99% 43830 override-expire ignore-reload ignore-no-store ignore-private ignore-auth ignore-must-revalidate store-stale
refresh_pattern -i \.wikimapia\.org\/? 10080 99% 10080 override-expire override-lastmod ignore-reload ignore-private

refresh_pattern -i \.(gif|png|pnp|img|jpg|jpeg|jpe?g|jpeg2|ico|mod|bmp|eps|tif|tiff?|pcx|pic|tga|iff|sct|pxr|raw|dcs|rle|lzw|ccit|f3d|woff)$ 10080 99% 10080 override-expire override-lastmod ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth store-stale
refresh_pattern -i \.(pps|ppsx|ps|rtx|wpl|doc|docx|pdf|xls|xlsx|latex|ppt|pptx|mbd|conf|txt|asm|pl|log|dll|bat|psd)$ 10080 99% 10080 override-expire override-lastmod ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth store-stale
refresh_pattern -i \.(mp4|3ivx|asf|avi|m2ts|divx|mjpeg|ogv|webm|mpg|mpeg|ogg|wmv|mkv|3gp|swf|flv|x-flv|3g2|vob|swf|swz|mov)$ 10080 99% 10080 override-expire override-lastmod ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth store-stale
refresh_pattern -i \.(ogg|mp2|ac3|mpc|m4a|flac|aiff|aif|aifc|raw|au|mid|wav|wv|mp3|gsm|dct|aac|mmf|wma|atrac|ra|ram|dss|msv|dvf|m4p|amr|awb|ape|apl)$ 10080 99% 10080 override-expire override-lastmod ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth store-stale
refresh_pattern -i \.(exe|dfg|crx|7z|mds|mod|mdl|arj|bz2|ms-dos|ccd|sub|deb|cab|pak|bin|cue|nrg|isz|mdf|qt|zip|tar|jar|jxr|jad|tar.gz|tar|msi|inc|lha|ms(i|p|u)|rpm|tgz|rtp|rpz|nui|kom|stg|pak|sup|nzp|npz|tgz|reg|vpx|idx|gz|avc|ref|msp|iso|info.gz|vdf.gz|rar|mar|dat|rp)$ 110080 99% 10080 override-expire override-lastmod ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth store-stale
refresh_pattern -i \.(css|js)$ 10080 99% 10080 override-expire override-lastmod ignore-reload ignore-no-store ignore-must-revalidate ignore-private ignore-auth store-stale
refresh_pattern -i (hackshield|nprotect|webnProtect) 0 0% 0
refresh_pattern -i \.(php|html|xml|aspx)$\? 0 0% 0 
################################



#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0	20% 4320

########################################################

range_offset_limit 1 KB
quick_abort_min 0 KB
quick_abort_max 0 KB
quick_abort_pct 100

##############################################

forwarded_for off
request_header_access X-Forwarded-For deny all 
request_header_access From deny all
request_header_access Server deny all
request_header_access Link deny all
request_header_access Via deny all
request_header_access WWW-Authenticate deny all
request_header_access Cache-Control deny all
request_header_access Proxy-Connection deny all
request_header_access X-Cache deny all
request_header_access X-Cache-Lookup deny all
request_header_access Forwarded-For deny all
request_header_access Pragma deny all
request_header_access Keep-Alive deny all

dns_nameservers 8.8.8.8 8.8.4.4
offline_mode off
memory_pools off
client_db off
cache_effective_user proxy
cache_effective_group proxy
reload_into_ims on
vary_ignore_expire on
qos_flows local-hit=0x30 